{% extends 'frontdeskbase.html' %}

{% block title %}Bulk Edit Purchase Orders{% endblock %}

{% load static %}

{% block head %}
    <link rel="stylesheet" href="{% static 'assets/modules/bootstrap-social/bootstrap-social.css' %}">
    <link rel="stylesheet" href="{% static 'assets/modules/datatables/datatables.min.css' %}">
    <link rel="stylesheet"
          href="{% static 'assets/modules/datatables/DataTables-1.10.16/css/dataTables.bootstrap4.min.css' %}">
    <link rel="stylesheet" href="{% static 'assets/modules/datatables/Select-1.2.4/css/select.bootstrap4.min.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/custom.css' %}">
    <script src="{% static 'assets/js/cleave.min.js' %}"></script>
    <style>
        .glow-on-hover {
            transition: box-shadow 0.3s ease-in-out;
        }

        .glow-on-hover:hover {
            box-shadow: 0 0 10px rgba(0, 90, 154, 0.8), 0 0 20px rgba(255, 255, 255, 0.6), 0 0 30px rgba(255, 255, 255, 0.4);
        }
    </style>
{% endblock %}

{% block content %}
    <div class="main-wrapper container-fluid">
        <div class="main-content">
            <section class="section container-fluid">
                <div class="section-body">
                    <div class="card card-primary">
                        <h2 style="text-align: center; margin-top: 10px;"><strong>EDIT FBBD REF#</strong></h2>

                        <div class="card-body">
                            <!-- Display messages -->
                           {% if messages %}
                                {% for message in messages %}
                                    <div class="alert alert-dismissible fade show text-center
                {% if message.tags == 'success' %}alert-success
                {% elif message.tags == 'error' %}alert-danger
                {% elif message.tags == 'info' %}alert-info
                {% elif message.tags == 'warning' %}alert-warning
                {% endif %}"
                                         style="color: #ffffff;"
                                         role="alert"><strong>{{ message }}</strong>
                                {% endfor %}
                            <button type="button" class="close" data-dismiss="alert" aria-label="Close"
                                    style="color: #004085;">
                                <span aria-hidden="true">&times;</span>
                            </button>
                            </div>
                            {% endif %}

                            <div class="form-inline justify-content-center col-12 mb-4">
                                <!-- Search Form -->
                                <form method="get" action="" class="form-inline col-4">
                                    <div class="input-group col-12">
                                        <input type="text" name="q" class="form-control"
                                               placeholder="Search Purchase Order Number"
                                               value="{{ query }}">
                                        <div class="input-group-append">
                                            <button class="btn btn-primary" type="submit">
                                                <i class="fas fa-search"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="ml-2">
                                        {% if query %}
                                            <a href="{% url 'bulk_edit_purchase_order' %}"
                                               class="btn btn-outline-primary">Clear Filter</a>
                                        {% endif %}
                                    </div>
                                </form>
                            </div>
                            <!-- Finalize Changes Form -->
                            <div class="row justify-content-center">
                                <div class="col-12 col-md-4">
                                    <form method="post" action="{% url 'bulk_edit_purchase_order' %}" class="mb-4">
                                        {% csrf_token %}
                                        <h3 class="text-center"><strong>Finalize Changes</strong></h3>

                                        <div class="form-row">
                                            <!-- FBBD Ref# Field -->
                                            <div class="col-12 col-md-6 mb-3">
                                                <div class="form-group">
                                                    <label for="fbbd_ref_number">FBBD Ref#:</label>
                                                    <input type="text" id="fbbd_ref_number" name="fbbd_ref_number"
                                                           class="form-control">
                                                </div>
                                            </div>

                                            <!-- Remarks2 Field -->
                                            <div class="col-12 col-md-6 mb-3">
                                                <div class="form-group">
                                                    <label for="remarks2">Remarks2:</label>
                                                    <select id="remarks2" name="remarks2" class="form-control">
                                                        <option value="">Select an option</option>
                                                        {% for value, label in remarks2_choices %}
                                                            <option value="{{ value }}">{{ label }}</option>
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                            </div>

                                            <!-- Finalize Changes Button -->
                                            <div class="col-12">
                                                <button type="submit" name="finalize_changes"
                                                        class="btn btn-primary btn-block">
                                                    Finalize Changes
                                                </button>
                                            </div>

                                        </div>
                                    </form>
                                </div>
                            </div>

                            <div class="col-12">
                                <div style="border-top: 1px solid #8f8f8f; margin: 20px 0; text-align: center;">
                                </div>
                            </div>

                            <!-- Cart Items -->
                            <h3 class="text-center mb-3">Cart Items</h3>
                            <div class="d-flex flex-column h-100">
                                <div class="flex-fill">
                                    <div class="row">
                                        {% if cart_items %}
                                            {% for cart_item in cart_items %}
                                                <div class="col-12 col-md-3 mb-2">
                                                    <div class="card card-primary glow-on-hover"
                                                         style="border: 2px solid #87a8fa; border-radius: 8px;">
                                                        <div class="card-body"
                                                             style="background-color: #ffffff; border-radius: 6px;">
                                                            <h5 class="card-title text-center">{{ cart_item.particulars.particulars }}</h5>
                                                            <p class="card-text">
                                                                PO Number: {{ cart_item.particulars.po_number }}<br>
                                                                Quantity:
                                                                <strong>{{ cart_item.particulars.quantity }}</strong><br>
                                                                Price: â‚±{{ cart_item.particulars.price }}<br>
                                                                FBBD Ref#: {{ cart_item.fbbd_ref_number }}<br>
                                                                Remarks2: {{ cart_item.remarks2 }}
                                                            </p>
                                                            <form method="POST"
                                                                  action="{% url 'po_remove_cart_item' cart_item.id %}">
                                                                {% csrf_token %}
                                                                <button type="submit" class="btn btn-danger">Remove
                                                                </button>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            {% endfor %}

                                            <!-- Remove All Cart Items Form -->
                                            <div class="col-12 d-flex justify-content-center mb-4">
                                                <div class="col-4">
                                                    <form method="post" action="{% url 'remove_all_cart_items' %}">
                                                        {% csrf_token %}
                                                        <button type="submit" class="btn btn-outline-primary btn-block">
                                                            Remove All Cart Items
                                                        </button>
                                                    </form>
                                                </div>
                                            </div>
                                        {% else %}
                                            <div class="col-12 d-flex justify-content-center align-items-center"
                                                 style="height: 30px;">
                                                <p class="text-center">No items in cart.</p>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>




                            <!-- Add to Cart Form -->
                            <form method="post" action="{% url 'bulk_edit_purchase_order' %}" class="mb-4">
                                {% csrf_token %}
                                <div class="d-flex justify-content-center align-items-center mb-4">
                                    <button type="submit" name="add_to_cart" class="btn btn-primary col-4">Add to Cart
                                    </button>
                                </div>
                                <h3 style="text-align: center"><strong>Purchase Orders</strong></h3>

                                <div class="row">
                                    {% for order in orders %}
                                        <div class="col-12 col-md-3 mb-2">
                                            <div class="card card-primary glow-on-hover"
                                                 style="border: 1px solid #336dff; border-radius: 5px;">
                                                <div class="card-body"
                                                     style="background-color: #ffffff; border-radius: 6px;">
                                                    <h5 class="card-title text-center">{{ order.particulars }}</h5>
                                                     <div class="col-12">
                                                        <div style="border-top: 1px solid #0026e5; margin: 4px 0;"></div>
                                                    </div>
                                                    <p class="card-text" style="margin-bottom: 0.1rem;">
                                                        PO Number: <strong>{{ order.po_number }}</strong><br>
                                                        <strong>Current Stock: {{ order.quantity }}</strong><br>
                                                        Price: â‚±{{ order.price }}<br>
                                                        Remarks: {{ order.remarks2 }}
                                                    </p>
                                                    <div class="d-flex justify-content-center">
                                                        <div class="custom-control custom-checkbox">
                                                            <input type="checkbox" class="custom-control-input"
                                                                   id="select_{{ order.id }}" name="po_ids"
                                                                   value="{{ order.id }}">
                                                            <label class="custom-control-label"
                                                                   for="select_{{ order.id }}">Add to Cart</label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    {% endfor %}
                                </div>

                            </form>

                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>
{% endblock %}
